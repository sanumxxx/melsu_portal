# HTML просмотр Office файлов через JavaScript

## Обзор

Система использует **клиентские JavaScript библиотеки** для конвертации Office файлов в HTML:

```
DOCX → mammoth.js → HTML документ
XLSX → SheetJS → HTML таблица
```

## Преимущества этого подхода

✅ **Клиентская обработка**: Вся конвертация происходит в браузере пользователя  
✅ **Быстрый отклик**: Мгновенная обработка без запросов к серверу  
✅ **Интерактивность**: HTML таблицы с hover-эффектами и стилизацией  
✅ **Полный HTML**: Богатое форматирование с CSS стилями  
✅ **Масштабируемость**: Нагрузка на клиенте, сервер не задействован  
✅ **Все данные Excel**: Поддержка всех листов и значений ячеек  
✅ **Надежность**: Проверенные библиотеки mammoth.js и SheetJS  

## Технические детали

### Зависимости
- `mammoth` (npm) - конвертация DOCX в HTML
- `xlsx` (npm) - чтение Excel файлов в браузере
- React компоненты для отображения

### Процесс конвертации

**Для DOCX файлов:**
1. **Загрузка в браузер**: файл передается как blob
2. **Чтение mammoth.js**: извлечение структуры и стилей
3. **HTML генерация**: создание семантичного HTML
4. **CSS стилизация**: применение стилей для Word-подобного вида

**Для XLSX файлов:**
1. **Клиентское чтение**: SheetJS парсит Excel файл
2. **Извлечение листов**: доступ ко всем worksheet
3. **HTML таблицы**: генерация интерактивных HTML таблиц
4. **Интерактивность**: hover-эффекты и стилизация заголовков

### API Эндпоинт

```
GET /api/files/{file_id}/preview
```

Возвращает оригинальный файл как blob для клиентской обработки.

### Fallback система

Если JavaScript библиотеки не смогли обработать файл:
- Показывается сообщение об ошибке с предложением скачать файл
- Для старых браузеров доступна кнопка скачивания

## Требования к серверу

- Стандартные возможности FastAPI для отдачи файлов
- Минимальная нагрузка - только передача blob данных
- Не требуется дополнительная оперативная память для конвертации
- Кэширование не нужно - обработка происходит на клиенте

**Никаких дополнительных серверных требований!**

## Файловая структура

```
frontend/
  src/components/common/
    OfficePreview.jsx       # Основной компонент просмотра
    OfficePreviewInfo.jsx   # Информация о технологии
backend/
  app/api/files.py          # API отдачи файлов
```

## Настройки производительности

- **Мгновенная обработка**: Конвертация происходит в браузере
- **Без таймаутов**: Нет ограничений на серверной стороне
- **Масштабируемость**: Каждый клиент обрабатывает свои файлы
- **Память**: Не нагружает серверную память

## Мониторинг

Логи обработки включают:
- ✅ Успешная загрузка blob данных
- ⚠️ Предупреждения при ошибках JavaScript
- ❌ Ошибки с предложением скачать файл

## Примеры использования

### Frontend (React)
```jsx
import OfficePreview from './OfficePreview';
import OfficePreviewInfo from './OfficePreviewInfo';

// Отображает HTML версию Office файла
<OfficePreview 
  fileId={file.id} 
  fileName={file.filename}
  onDownload={handleDownload}
/>

// Показывает информацию о технологии
<OfficePreviewInfo />
```

### Backend (Python)
```python
# Простая отдача файлов как blob
@app.get("/api/files/{file_id}/preview")
async def get_file_preview(file_id: int):
    # Возвращает оригинальный файл для клиентской обработки
    return FileResponse(file_path)
```

---

**Результат**: Пользователи видят DOCX документы как HTML с богатым форматированием, а XLSX таблицы как интерактивные HTML таблицы с hover-эффектами и полной функциональностью прямо в браузере. 