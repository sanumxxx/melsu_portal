# Система объявлений

## Описание
Система объявлений позволяет администраторам создавать объявления для пользователей портала. Объявления отображаются в модальном окне при входе пользователя в систему.

## Основные возможности

### Для администраторов:
- **Создание объявлений** с заголовком, описанием и изображением
- **Настройка целевой аудитории** - можно выбрать роли пользователей или показывать всем
- **Управление статусом** - активация/деактивация объявлений
- **Загрузка изображений** до 5MB (PNG, JPG, GIF)
- **Просмотр статистики** - количество просмотров каждого объявления
- **Редактирование и удаление** существующих объявлений

### Для пользователей:
- **Автоматическое отображение** последнего непросмотренного объявления при входе
- **Модальное окно** с красивым дизайном посередине экрана
- **Кнопка "Просмотрено"** для закрытия объявления
- **Фильтрация по ролям** - пользователи видят только объявления для своих ролей

## Техническая реализация

### Backend (FastAPI)
- **Модели**: `Announcement`, `AnnouncementView`
- **API эндпоинты**:
  - `POST /api/announcements/` - создание объявления
  - `GET /api/announcements/` - список объявлений (админ)
  - `GET /api/announcements/current` - текущее объявление для пользователя
  - `POST /api/announcements/mark-viewed` - отметка как просмотренное
  - `POST /api/announcements/upload-image` - загрузка изображения
  - `PUT /api/announcements/{id}` - редактирование
  - `DELETE /api/announcements/{id}` - удаление

### Frontend (React)
- **AnnouncementManager** - компонент управления для админов
- **AnnouncementModal** - модальное окно для пользователей
- **Автоматическая интеграция** в Layout.jsx

### База данных
```sql
-- Таблица объявлений
CREATE TABLE announcements (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    image_url VARCHAR(500),
    target_roles JSON,  -- null = для всех ролей
    is_active BOOLEAN DEFAULT true,
    created_by_id INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);

-- Таблица просмотров
CREATE TABLE announcement_views (
    id SERIAL PRIMARY KEY,
    announcement_id INTEGER REFERENCES announcements(id),
    user_id INTEGER REFERENCES users(id),
    viewed_at TIMESTAMP DEFAULT NOW()
);
```

## Логика работы

1. **Администратор создает объявление** через интерфейс `/admin/announcements`
2. **Система определяет целевую аудиторию** на основе ролей пользователя
3. **При входе пользователя** проверяется наличие непросмотренных объявлений
4. **Показывается последнее объявление** в модальном окне
5. **После нажатия "Просмотрено"** создается запись в `announcement_views`
6. **Объявление больше не показывается** этому пользователю

## Особенности

### Приоритизация объявлений
- Показывается только **последнее** созданное объявление
- Если пользователь его уже просмотрел - ничего не показывается
- Новые объявления "перекрывают" старые

### Система ролей
Доступные роли для таргетинга:
- `admin` - Администраторы  
- `teacher` - Преподаватели
- `employee` - Сотрудники
- `student` - Студенты
- `schoolchild` - Школьники

Если роли не указаны - объявление показывается всем пользователям.

### Загрузка изображений
- Максимальный размер: 5MB
- Поддерживаемые форматы: PNG, JPG, GIF
- Файлы сохраняются в `uploads/announcements/`
- Автоматическая генерация уникальных имен файлов

## Доступ к функциям

### Администраторы
- Полный доступ ко всем функциям
- Меню: Администрирование → Объявления

### Обычные пользователи  
- Только просмотр объявлений в модальном окне
- Автоматическое отображение при входе

## Файлы системы

### Backend
- `backend/app/models/announcement.py` - модели данных
- `backend/app/schemas/announcement.py` - схемы Pydantic
- `backend/app/api/announcements.py` - API эндпоинты
- `backend/alembic/versions/*_create_announcements_tables.py` - миграция БД

### Frontend  
- `frontend/src/components/admin/AnnouncementManager.jsx` - управление (админ)
- `frontend/src/components/AnnouncementModal.jsx` - модальное окно
- Интеграция в `Layout.jsx` и `App.jsx`

## Возможные улучшения

1. **Множественные объявления** - показ нескольких объявлений подряд
2. **Планировщик** - отложенная публикация объявлений
3. **Уведомления** - интеграция с WebSocket для real-time уведомлений
4. **Аналитика** - детальная статистика просмотров
5. **Шаблоны** - готовые шаблоны для разных типов объявлений
6. **Экспорт** - выгрузка статистики в Excel/PDF 