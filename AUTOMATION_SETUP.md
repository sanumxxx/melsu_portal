# ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è MELSU Portal

–ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –±–µ–∑ Docker —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–Ω–∞—á–∞–ª—å–Ω–∞—è-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
2. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-github-actions)  
3. [–°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è](#—Å–∫—Ä–∏–ø—Ç—ã-—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
4. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
5. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
6. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üöÄ –ù–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@your-server-ip

# –ó–∞–ø—É—Å–∫–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
curl -sSL https://raw.githubusercontent.com/sanumxxx/melsu_portal/main/deploy.sh | bash

# –ò–ª–∏ —Å–∫–∞—á–∏–≤–∞–µ–º –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
wget https://raw.githubusercontent.com/sanumxxx/melsu_portal/main/deploy.sh
chmod +x deploy.sh
./deploy.sh
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —É –≤–∞—Å –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã:

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
melsu status          # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
melsu update          # –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
melsu restart         # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
melsu-auto-update     # –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –æ—Ç–∫–∞—Ç–æ–º
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Actions

### 1. –°–æ–∑–¥–∞–Ω–∏–µ SSH –∫–ª—é—á–∞ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

–ù–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ:

```bash
# –°–æ–∑–¥–∞–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π SSH –∫–ª—é—á –¥–ª—è GitHub Actions
ssh-keygen -t ed25519 -f ~/.ssh/github_deploy_key -N ""

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ authorized_keys
cat ~/.ssh/github_deploy_key.pub >> ~/.ssh/authorized_keys

# –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ GitHub Secrets
cat ~/.ssh/github_deploy_key
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–ò–¥–µ–º –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub ‚Üí Settings ‚Üí Secrets and variables ‚Üí Actions

–î–æ–±–∞–≤–ª—è–µ–º —Å–ª–µ–¥—É—é—â–∏–µ secrets:

| –ù–∞–∑–≤–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `SERVER_HOST` | `82.202.130.12` | IP –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ |
| `SERVER_USER` | `root` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è |
| `SERVER_SSH_KEY` | `–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á` | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ ~/.ssh/github_deploy_key |

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ GitHub Actions

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ secrets:

1. –°–¥–µ–ª–∞–π—Ç–µ –ª—é–±–æ–π –∫–æ–º–º–∏—Ç –≤ –≤–µ—Ç–∫—É `main`
2. Push –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Actions –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
4. –ù–∞–±–ª—é–¥–∞–π—Ç–µ –∑–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

---

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `melsu`

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
melsu start           # –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
melsu stop            # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
melsu restart         # –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
melsu update          # –ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏
melsu status          # –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ë–î
melsu migrate         # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
melsu backup          # –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
melsu logs            # –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏
melsu live-logs       # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
melsu test            # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
melsu ssl             # –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
melsu deploy          # –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: `melsu-auto-update`

–ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å:
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –±—ç–∫–∞–ø–æ–º –ë–î
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ Health check
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ—Ç–∫–∞—Ç–æ–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

```bash
# –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
melsu-auto-update

# –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
tail -f /var/log/melsu/auto_update.log
```

---

## ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º cron —Ñ–∞–π–ª:

```bash
nano /etc/cron.d/melsu-auto-update
```

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ —Å—Ç—Ä–æ–∫—É –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π:

```cron
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00 —É—Ç—Ä–∞
0 3 * * * root /usr/local/bin/melsu-auto-update >> /var/log/melsu/auto_update.log 2>&1
```

### 2. –î—Ä—É–≥–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

```cron
# –ö–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤
0 */6 * * * root /usr/local/bin/melsu-auto-update

# –¢–æ–ª—å–∫–æ –≤ —Ä–∞–±–æ—á–∏–µ –¥–Ω–∏ –≤ 2:00
0 2 * * 1-5 root /usr/local/bin/melsu-auto-update

# –ö–∞–∂–¥–æ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –≤ 4:00
0 4 * * 0 root /usr/local/bin/melsu-auto-update
```

### 3. Webhook –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ push, —Å–æ–∑–¥–∞–π—Ç–µ endpoint:

```bash
# –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π webhook —Å–∫—Ä–∏–ø—Ç
tee /var/www/melsu/webhook.php > /dev/null <<'EOF'
<?php
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $payload = json_decode(file_get_contents('php://input'), true);
    
    if ($payload['ref'] === 'refs/heads/main') {
        // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
        exec('/usr/local/bin/melsu-auto-update > /dev/null 2>&1 &');
        http_response_code(200);
        echo "Update triggered";
    }
}
?>
EOF

# –î–æ–±–∞–≤–ª—è–µ–º –≤ Nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
# location /webhook.php {
#     fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
#     include fastcgi_params;
#     fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
# }
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏

### 1. –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –ª–æ–≥–∏
journalctl -u melsu-api -f           # API –ª–æ–≥–∏
journalctl -u melsu-worker -f        # Worker –ª–æ–≥–∏
tail -f /var/log/nginx/error.log     # Nginx –æ—à–∏–±–∫–∏

# –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
tail -f /var/log/melsu/auto_update.log

# –í—Å–µ –ª–æ–≥–∏ MELSU
journalctl -u melsu-* -f
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞

```bash
# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ–≥–æ
melsu status

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–∏—Å–∞—Ö
systemctl status melsu-api melsu-worker nginx postgresql redis-server

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î
sudo -u postgres psql melsu_db -c "SELECT datname, numbackends FROM pg_stat_database WHERE datname='melsu_db';"
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ alert–æ–≤

–°–æ–∑–¥–∞–µ–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è —Å–∏—Å—Ç–µ–º—ã:

```bash
tee /usr/local/bin/melsu-health-monitor > /dev/null <<'EOF'
#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º API
if ! curl -s http://localhost:8000/health > /dev/null; then
    echo "CRITICAL: API not responding" | logger -t melsu-monitor
    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (email, Slack, Telegram)
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
DISK_USAGE=$(df / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 90 ]; then
    echo "WARNING: Disk usage at ${DISK_USAGE}%" | logger -t melsu-monitor
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–º—è—Ç—å
MEM_USAGE=$(free | awk 'NR==2{printf "%.0f", $3*100/$2}')
if [ $MEM_USAGE -gt 90 ]; then
    echo "WARNING: Memory usage at ${MEM_USAGE}%" | logger -t melsu-monitor
fi
EOF

chmod +x /usr/local/bin/melsu-health-monitor

# –î–æ–±–∞–≤–ª—è–µ–º –≤ cron (–∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç)
echo "*/5 * * * * root /usr/local/bin/melsu-health-monitor" >> /etc/cron.d/melsu-monitoring
```

---

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

–ù–∞ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ:

```bash
cd backend
source venv/bin/activate

# –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "–û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–≥—Ä–∞—Ü–∏—é
alembic show head

# –ö–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
git add alembic/versions/
git commit -m "Add new migration: –æ–ø–∏—Å–∞–Ω–∏–µ"
git push origin main
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ú–∏–≥—Ä–∞—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏:
- GitHub Actions —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
- –ö–æ–º–∞–Ω–¥–µ `melsu update`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ `melsu-auto-update`

–†—É—á–Ω–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

```bash
# –¢–æ–ª—å–∫–æ –º–∏–≥—Ä–∞—Ü–∏–∏
melsu migrate

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é –≤–µ—Ä—Å–∏—é –ë–î
cd /var/www/melsu/backend
sudo -u melsu venv/bin/alembic current
```

### 3. –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

```bash
cd /var/www/melsu/backend

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Å—Ç–æ—Ä–∏—é
sudo -u melsu venv/bin/alembic history

# –û—Ç–∫–∞—Ç–∏—Ç—å –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–≤–∏–∑–∏–∏
sudo -u melsu venv/bin/alembic downgrade <revision_id>

# –û—Ç–∫–∞—Ç–∏—Ç—å –Ω–∞ –æ–¥–Ω—É –≤–µ—Ä—Å–∏—é –Ω–∞–∑–∞–¥
sudo -u melsu venv/bin/alembic downgrade -1
```

---

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### 1. GitHub Actions –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh -i ~/.ssh/github_deploy_key root@your-server-ip

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ —Ñ–∞–π–ª—ã
ls -la ~/.ssh/
cat ~/.ssh/authorized_keys | grep github

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ GitHub Actions
# –ò–¥–µ–º –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí Actions ‚Üí –ø–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞–ø—É—Å–∫
```

### 2. –û—à–∏–±–∫–∏ –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏—è—Ö

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î
sudo -u postgres psql melsu_db -c "\dt"

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–≤–∏–∑–∏—é (–û–°–¢–û–†–û–ñ–ù–û!)
cd /var/www/melsu/backend
sudo -u melsu venv/bin/alembic stamp head

# –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–∑ –±—ç–∫–∞–ø–∞
ls -la /var/backups/melsu/
gunzip -c /var/backups/melsu/melsu_db_backup_YYYYMMDD_HHMMSS.sql.gz | sudo -u postgres psql melsu_db
```

### 3. –°–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ –ª–æ–≥–∏
systemctl status melsu-api
journalctl -u melsu-api -n 50

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cd /var/www/melsu/backend
source venv/bin/activate
python -c "from app.main import app; print('App loads successfully')"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ
melsu restart
```

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

```bash
# –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥
cd /var/www/melsu/frontend
sudo -u melsu npm install
sudo -u melsu npm run build

# –ü—Ä–æ–≤–µ—Ä—è–µ–º Nginx
nginx -t
systemctl reload nginx
```

---

## üìû –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã
melsu status && melsu test

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
melsu live-logs

# –ë—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
melsu restart

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
melsu update
```

### –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
melsu backup

# –ü—Ä–æ—Å–º–æ—Ç—Ä –±—ç–∫–∞–ø–æ–≤
ls -la /var/backups/melsu/

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –±—ç–∫–∞–ø–∞
gunzip -c /var/backups/melsu/backup_file.sql.gz | sudo -u postgres psql melsu_db
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏ MELSU
journalctl -u melsu-* --since "1 hour ago"

# –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
journalctl -u melsu-api -p err --since today

# –õ–æ–≥–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
tail -100 /var/log/melsu/auto_update.log
```

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è:

1. **GitHub Actions** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏ push –≤ main
2. **–°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** `melsu` —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** —Å –±—ç–∫–∞–ø–æ–º –∏ –æ—Ç–∫–∞—Ç–æ–º
4. **–°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
5. **–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** –ë–î

**–û—Å–Ω–æ–≤–Ω–æ–π workflow:**
1. –î–µ–ª–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ
2. Push –≤ GitHub
3. Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–µ—Ä–≤–µ—Ä
4. –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
5. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –æ—Ç–∫–∞—Ç

üéâ **–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å—Ç–∞–ª–æ –ø—Ä–æ—Å—Ç—ã–º –∏ –±–µ–∑–æ–ø–∞—Å–Ω—ã–º!** 